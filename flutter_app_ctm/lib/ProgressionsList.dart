import 'package:flutter/material.dart';
import 'package:carousel_slider/carousel_slider.dart';

class ProgressionsList extends StatelessWidget {
  var prog = {
    "Build": [
      {
        "_id": "5c62677b33a38775a2030c03",
        "activity_failed": true,
        "actual": 66,
        "arrival_dt": "2019-02-12T06:28:11.058000",
        "change_count": 8,
        "control_failed": false,
        "fullversion_from": "master.66",
        "fullversion_to": "master.73",
        "last_update_dt": "2019-02-12T10:02:34.348000",
        "package_id": "5bb72a361c5ddd6d22523d0f",
        "package_name": "p2",
        "pending_activity": false,
        "phase_name": "Build",
        "progression_id": "5bb5d4911c5ddd17886368ab",
        "rev_from": 66,
        "rev_from_id": "5c62677b33a38775a2030bf6",
        "rev_to": 73,
        "rev_to_id": "5c6299ba33a38727eba2dbbb",
        "risk_coverage_percentage": null,
        "risk_coverage_report_url": null,
        "risk_dashboard_url": null,
        "risk_failed_tests_count": null,
        "risk_failed_tests_report_url": null,
        "risk_has_failed_tests": false,
        "risk_has_high_risk_file": false,
        "risk_has_low_coverage": false,
        "risk_has_severity1_violations": false,
        "risk_severity1_report_url": null,
        "risk_severity1_violation_count": null,
        "risk_show_dashboard_link": false,
        "team_id": "5bb1e8851c5ddd568a4bf08a",
        "unmanaged_change_count": 1,
        "version": "master",
        "workitem_count": 1,
        "workitems": [
          {
            "_id": "5c1c847b1c5ddd2ac1f844e1",
            "change_count": 9,
            "external_id": "artf1029",
            "external_key": "artf1029",
            "title": "[sample] Defect One",
            "value_goal": "maintain"
          }
        ]
      },
      {
        "_id": "5c1c82e21c5ddd12e10ed079",
        "activity_failed": false,
        "actual": 75,
        "arrival_dt": "2018-12-21T06:06:26.603000",
        "change_count": 9,
        "control_failed": true,
        "fullversion_from": "master.77",
        "fullversion_to": "master.85",
        "last_update_dt": "2019-02-12T10:02:34.070000",
        "package_id": "5bb1c13e1c5ddd505473a69f",
        "package_name": "p1",
        "pending_activity": false,
        "phase_name": "Build",
        "progression_id": "5bb5d4911c5ddd17886368ab",
        "rev_from": 77,
        "rev_from_id": "5c1c847b1c5ddd2ac1f844e9",
        "rev_to": 85,
        "rev_to_id": "5c6299ba33a38727eba2db8f",
        "risk_coverage_percentage": null,
        "risk_coverage_report_url": null,
        "risk_dashboard_url": null,
        "risk_failed_tests_count": null,
        "risk_failed_tests_report_url": null,
        "risk_has_failed_tests": false,
        "risk_has_high_risk_file": false,
        "risk_has_low_coverage": false,
        "risk_has_severity1_violations": false,
        "risk_severity1_report_url": null,
        "risk_severity1_violation_count": null,
        "risk_show_dashboard_link": false,
        "team_id": "5badc6071c5ddd2b34f414b5",
        "unmanaged_change_count": 1,
        "version": "master",
        "workitem_count": 1,
        "workitems": [
          {
            "_id": "5c1c847b1c5ddd2ac1f844e1",
            "change_count": 9,
            "external_id": "artf1029",
            "external_key": "artf1029",
            "title": "[sample] Defect One",
            "value_goal": "maintain"
          }
        ]
      }
    ],
    "Deploy": [
      {
        "_id": "5c01298e1c5ddd0c91a52b65",
        "activity_failed": true,
        "actual": 73,
        "arrival_dt": "2018-11-30T12:14:05.916000",
        "change_count": 4,
        "control_failed": false,
        "fullversion_from": "master.73",
        "fullversion_to": "master.76",
        "last_update_dt": "2019-01-22T16:58:25.349000",
        "package_id": "5bb1c13e1c5ddd505473a69f",
        "package_name": "p1",
        "pending_activity": false,
        "phase_name": "Deploy",
        "progression_id": "5bb5d4911c5ddd17886368ab",
        "rev_from": 73,
        "rev_from_id": "5c01296b1c5ddd59b11d2bf9",
        "rev_to": 76,
        "rev_to_id": "5c1c84081c5ddd242bf844db",
        "risk_coverage_percentage": null,
        "risk_coverage_report_url": null,
        "risk_dashboard_url": null,
        "risk_failed_tests_count": null,
        "risk_failed_tests_report_url": null,
        "risk_has_failed_tests": false,
        "risk_has_high_risk_file": false,
        "risk_has_low_coverage": false,
        "risk_has_severity1_violations": false,
        "risk_severity1_report_url": null,
        "risk_severity1_violation_count": null,
        "risk_show_dashboard_link": false,
        "team_id": "5badc6071c5ddd2b34f414b5",
        "unmanaged_change_count": 2,
        "version": "master",
        "workitem_count": 1,
        "workitems": [
          {
            "_id": "5c1c82e21c5ddd12e10ed064",
            "change_count": 2,
            "external_id": "artf1021",
            "external_key": "artf1021",
            "title": "[sample] Task Five",
            "value_goal": ""
          }
        ]
      },
      {
        "_id": "5bbb4b651c5ddd366d9e15ef",
        "activity_failed": true,
        "actual": 22,
        "arrival_dt": "2018-10-08T12:19:49.301000",
        "change_count": 65,
        "control_failed": false,
        "fullversion_from": "master.1",
        "fullversion_to": "master.65",
        "last_update_dt": "2019-01-22T16:55:11.921000",
        "package_id": "5bb72a361c5ddd6d22523d0f",
        "package_name": "p2",
        "pending_activity": false,
        "phase_name": "Deploy",
        "progression_id": "5bb5d4911c5ddd17886368ab",
        "rev_from": 1,
        "rev_from_id": "5bb72ac61c5ddd023f0ee649",
        "rev_to": 65,
        "rev_to_id": "5c1c847b1c5ddd2ac1f84516",
        "risk_coverage_percentage": null,
        "risk_coverage_report_url": null,
        "risk_dashboard_url": null,
        "risk_failed_tests_count": null,
        "risk_failed_tests_report_url": null,
        "risk_has_failed_tests": false,
        "risk_has_high_risk_file": false,
        "risk_has_low_coverage": false,
        "risk_has_severity1_violations": false,
        "risk_severity1_report_url": null,
        "risk_severity1_violation_count": null,
        "risk_show_dashboard_link": false,
        "team_id": "5bb1e8851c5ddd568a4bf08a",
        "unmanaged_change_count": 62,
        "version": "master",
        "workitem_count": 2,
        "workitems": [
          {
            "_id": "5c1c82e21c5ddd12e10ed064",
            "change_count": 2,
            "external_id": "artf1021",
            "external_key": "artf1021",
            "title": "[sample] Task Five",
            "value_goal": ""
          },
          {
            "_id": "5c1c847b1c5ddd2ac1f844e1",
            "change_count": 9,
            "external_id": "artf1029",
            "external_key": "artf1029",
            "title": "[sample] Defect One",
            "value_goal": "maintain"
          }
        ]
      }
    ],
    "Release": [],
    "Stage": [],
    "Test": []
  };

  var getProg = {
    "_id": "5bb5d4911c5ddd17886368ab",
    "description": "test",
    "name": "prog1",
    "phases": [
      {
        "code_complete": true,
        "delivery_category": "Packaged",
        "description": "",
        "has_dnstream": true,
        "has_upstream": false,
        "index": 0,
        "name": "Build"
      },
      {
        "code_complete": false,
        "delivery_category": "Packaged",
        "description": "",
        "has_dnstream": true,
        "has_upstream": true,
        "index": 1,
        "name": "Deploy"
      },
      {
        "code_complete": false,
        "delivery_category": "Packaged",
        "description": "",
        "has_dnstream": true,
        "has_upstream": true,
        "index": 2,
        "name": "Test"
      },
      {
        "code_complete": false,
        "delivery_category": "Packaged",
        "description": "",
        "has_dnstream": true,
        "has_upstream": true,
        "index": 3,
        "name": "Stage"
      },
      {
        "code_complete": false,
        "delivery_category": "Packaged",
        "description": "",
        "has_dnstream": false,
        "has_upstream": true,
        "index": 4,
        "name": "Release"
      }
    ]
  };

  @override
  Widget build(BuildContext context) {
    var array = [];
    getProg.forEach((key, value) => {
          if (key == 'phases') for (var val in value) array.add(val["name"]),
        });
    return new Scaffold(
      appBar: new AppBar(
        title: Text('Progressions'),
      ),
      body: CarouselSlider(
        height: 900.0,
        enableInfiniteScroll: false,
        enlargeCenterPage: true,
        items: array.map((i) {
          return Builder(
            builder: (BuildContext context) {
              return Container(
                  width: MediaQuery.of(context).size.width,
                  margin: EdgeInsets.symmetric(horizontal: 5.0),
                  decoration: BoxDecoration(color: Colors.white),
                  child: ListView(
                    padding: const EdgeInsets.all(8.0),
                    children: <Widget>[
                      new Text(i,
                          style: new TextStyle(
                              fontSize: 24.0, fontWeight: FontWeight.bold),
                          textAlign: TextAlign.center),
                      for (var p in prog[i])
                        new Card(
                          child: new Column(
                            crossAxisAlignment: CrossAxisAlignment.stretch,
                            children: <Widget>[
                              new Container(
                                child: new Row(
                                    mainAxisAlignment:
                                        MainAxisAlignment.spaceBetween,
                                    children: <Widget>[
                                      new Padding(
                                          padding: const EdgeInsets.all(16.0),
                                          child: new Container(
                                              padding: EdgeInsets.all(4.0),
                                              decoration: BoxDecoration(
                                                  borderRadius:
                                                      BorderRadius.circular(
                                                          6.0),
                                                  color: Colors.blue),
                                              child: new Text(
                                                p["fullversion_from"] +
                                                    "-" +
                                                    p["fullversion_to"],
                                                style: TextStyle(
                                                  fontSize: 14.0,
                                                  color: Colors.white,
                                                ),
                                              ))),
                                      new Container(
                                          padding: EdgeInsets.all(4.0),
                                          child: new Text(
                                            'Forecast: ${p["actual"]}  days',
                                            style: TextStyle(
                                              fontSize: 14.0,
                                            ),
                                          ))
                                    ]),
                                alignment: FractionalOffset(0.1, 0.1),
                              ),
                              new ListTile(
                                title: new Text(
                                  p["package_name"],
                                  style: new TextStyle(
                                      fontWeight: FontWeight.bold),
                                ),
                                subtitle: new Text(p["version"],
                                    style: new TextStyle(
                                        fontSize: 16.0, color: Colors.blue)),
                              ),
                              new Container(
                                  child: new Row(
                                      mainAxisAlignment:
                                          MainAxisAlignment.spaceBetween,
                                      children: <Widget>[
                                    p["unmanaged_change_count"] > 0
                                        ? new Container(
                                            padding: EdgeInsets.all(8.0),
                                            child: new Image.asset(
                                              'images/unmanaged_commit.svg'
                                            ))
                                        : new Container(),
                                    new Container(
                                        padding: EdgeInsets.all(8.0),
                                        child: new Text(
                                            'Revisions: ${p["rev_from"]} - ${p["rev_to"]}',
                                            style: TextStyle(
                                              fontSize: 14.0,
                                            )))
                                  ]))
                            ],
                          ),
                        ),
                    ],
                  )
                  // Text('text $i \n $testData', style: TextStyle(fontSize: 16.0), maxLines: 60)
                  );
            },
          );
        }).toList(),
      ),
    );
  }
}
